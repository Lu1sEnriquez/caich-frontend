<aside class="mini-sidebar">
  
  <div class="mini-top-section">
    <button class="mini-menu-btn" (click)="toggleDrawer()" title="Expandir menÃº">
      <i class="pi pi-bars"></i>
    </button>
  </div>

  <!-- <div class="mini-header">
    <button class="mini-logo-btn" (click)="toggleDrawer()">
      <span class="logo-icon">ðŸ§ </span>
      @if (totalNotifications() > 0) {
        <span class="mini-badge-dot"></span>
      }
    </button>
  </div> -->

  <nav class="mini-nav">
    @for (group of menuGroups(); track group.title) {
      @for (item of group.items; track item.label) {
        <a [routerLink]="item.route" 
           routerLinkActive="active" 
           [title]="item.label" 
           class="mini-link">
           <span class="mini-icon">{{ item.icon }}</span>
        </a>
      }
    }
  </nav>

  <div class="mini-footer">
    <div class="mini-avatar" (click)="toggleDrawer()">
      @if (currentUser()?.foto) {
        <img [src]="currentUser()?.foto" alt="User">
      } @else {
        <span>{{ (currentUserName() || 'U').charAt(0).toUpperCase() }}</span>
      }
    </div>
  </div>
</aside>


<p-drawer 
    [(visible)]="drawerVisible" 
    position="left" 
    [modal]="true"
    styleClass="custom-sidebar-drawer">
    
    <div class="drawer-content">
      
      <div class="sidebar-header">
        <button class="logo" (click)="goToDashboard()">
          <div class="logo-content">
            <span class="logo-icon">ðŸ§ </span>
            <span class="logo-text">{{ appName() }}</span>
          </div>
        </button>
        
        <button (click)="toggleNotifications()" class="logo-notif-badge-btn">
            @if (totalNotifications() > 0) {
                <app-badge variant="danger">{{ totalNotifications() }}</app-badge>
            } @else {
                <span class="notif-icon">ðŸ””</span>
            }
        </button>
      </div>

      <nav class="sidebar-nav">
        @for (group of menuGroups(); track group.title) {
        <div class="menu-group">
          @if (group.title) {
          <div class="menu-group-title">{{ group.title }}</div>
          }
          <ul class="menu-items">
            @for (item of group.items; track item.label) {
            <li class="menu-item">
              <a [routerLink]="item.route"
                routerLinkActive="active"
                [routerLinkActiveOptions]="{ exact: false }"
                class="menu-link"
                (click)="closeDrawer()">
                @if (item.icon) { <span class="menu-icon">{{ item.icon }}</span> }
                <span class="menu-label">{{ item.label }}</span>
                @if (item.badge) { <app-badge variant="info">{{ item.badge }}</app-badge> }
              </a>
            </li>
            }
          </ul>
        </div>
        }
      </nav>

      <div class="sidebar-footer">
        <div class="user-section">
          <div class="user-profile">
            <img *ngIf="currentUser()?.foto" [src]="currentUser()?.foto" class="user-avatar" />
            <div *ngIf="!currentUser()?.foto" class="user-avatar user-avatar-placeholder">
              {{ (currentUserName() || 'U').charAt(0).toUpperCase() }}
            </div>
            <div class="user-details">
              <div class="user-name">{{ currentUserName() }}</div>
              <div class="user-role-display">{{ userRole() }}</div>
            </div>
          </div>
          <button class="logout-button" (click)="onLogoutClick()">
            <span>{{ logoutLabel() }}</span>
          </button>
        </div>
      </div>

    </div>
</p-drawer>

@if (notificationsPanelIsOpen()) {
<div class="notifications-panel-wrapper">
  <app-notification-panel (closed)="toggleNotifications()"></app-notification-panel>
</div>
}