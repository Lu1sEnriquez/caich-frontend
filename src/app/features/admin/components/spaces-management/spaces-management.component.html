<div class="spaces-management">
  <div class="header">
    <h1>üè¢ Gesti√≥n de Espacios/Cub√≠culos</h1>
    <button (click)="openModal()" class="btn-primary">
      ‚ûï Nuevo Espacio
    </button>
  </div>

  <!-- Cargando -->
  @if (spacesResource.isLoading()) {
  <div class="loading">
    <p>Cargando espacios...</p>
  </div>
  }

  <!-- Lista de espacios -->
  @if (spaces().length > 0) {
  <div class="spaces-grid">
    @for (space of spaces(); track space.espacioId) {
    <app-card class="space-card">
      <div class="space-header">
        <h3>{{ space.nombre }}</h3>
        <app-badge
          [variant]="space.estaActivo ? 'success' : 'destructive'"
        >
          {{ space.estaActivo ? '‚úì Activo' : '‚úó Inactivo' }}
        </app-badge>
      </div>

      <div class="space-details">
        <p><strong>Tipo:</strong> {{ space.tipo }}</p>
        <p><strong>Capacidad:</strong> {{ space.capacidad }} personas</p>
        <p><strong>Costo/hora:</strong> {{ formatCost(space.costoPorHora) }}</p>
        @if (space.descripcion) {
        <p><strong>Descripci√≥n:</strong> {{ space.descripcion }}</p>
        }
      </div>

      <div class="space-actions">
        <button (click)="editSpace(space)" class="btn-secondary">‚úèÔ∏è Editar</button>
        <button (click)="toggleStatus(space)" class="btn-info">
          {{ space.estaActivo ? 'üîí Desactivar' : 'üîì Activar' }}
        </button>
        <button (click)="deleteSpace(space)" class="btn-danger">üóëÔ∏è Eliminar</button>
      </div>
    </app-card>
    }
  </div>
  } @else {
  <div class="empty-state">
    <p>No hay espacios registrados</p>
  </div>
  }

  <!-- Modal -->
  @if (showModal()) {
  <div class="modal-overlay" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ isEditing() ? '‚úèÔ∏è Editar Espacio' : '‚ûï Nuevo Espacio' }}</h2>
        <button (click)="closeModal()" class="btn-close">‚úï</button>
      </div>

      <form [formGroup]="form" (ngSubmit)="saveSpace()" class="modal-content">
        <div class="form-group">
          <label>Nombre *</label>
          <input
            type="text"
            formControlName="nombre"
            placeholder="Ej: Cub√≠culo A1"
            class="form-input"
          />
          @if (form.get('nombre')?.invalid && form.get('nombre')?.touched) {
          <span class="error">El nombre es requerido y debe tener m√≠nimo 2 caracteres</span>
          }
        </div>

        <div class="form-group">
          <label>Tipo *</label>
          <select formControlName="tipo" class="form-input">
            <option value="" disabled>Selecciona un tipo</option>
            @for (type of spaceTypes(); track type) {
            <option [value]="type">{{ type }}</option>
            }
          </select>
          @if (form.get('tipo')?.invalid && form.get('tipo')?.touched) {
          <span class="error">El tipo es requerido</span>
          }
        </div>

        <div class="form-group">
          <label>Descripci√≥n</label>
          <textarea formControlName="descripcion" placeholder="Descripci√≥n opcional" class="form-input"></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Capacidad *</label>
            <input
              type="number"
              formControlName="capacidad"
              min="1"
              class="form-input"
            />
            @if (form.get('capacidad')?.invalid && form.get('capacidad')?.touched) {
            <span class="error">La capacidad es requerida y debe ser mayor a 0</span>
            }
          </div>

          <div class="form-group">
            <label>Costo por hora *</label>
            <input
              type="number"
              formControlName="costoPorHora"
              min="0"
              step="0.01"
              class="form-input"
            />
            @if (form.get('costoPorHora')?.invalid && form.get('costoPorHora')?.touched) {
            <span class="error">El costo es requerido</span>
            }
          </div>
        </div>

        <div class="form-group">
          <label class="checkbox-label">
            <input type="checkbox" formControlName="estaActivo" />
            <span>Espacio Activo</span>
          </label>
        </div>

        <div class="modal-footer">
          <button type="button" (click)="closeModal()" class="btn-secondary">
            Cancelar
          </button>
          <button type="submit" [disabled]="form.invalid" class="btn-primary">
            {{ isEditing() ? 'Actualizar' : 'Crear' }} Espacio
          </button>
        </div>
      </form>
    </div>
  </div>
  }
</div>
